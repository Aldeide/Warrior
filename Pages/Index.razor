@page "/"
@using Microsoft.Extensions.Logging
@using Blazored.LocalStorage;
@using System.ComponentModel;

@inject ILogger<Settings> Logger
@inject Blazored.LocalStorage.ISyncLocalStorageService localStorage
@inject Simulation simulation;
@inject HttpClient Http

<EditForm EditContext="@editContext">
	<div class="sidebar summary" style="min-width: 300px; background-color: #eee; background-image: none;">
		<Warrior.Shared.Component.Summary editContext=@editContext />
	</div>
	<section id="items">
		<div class="main" style="width: 100%;">
			<div class="content">
				<div class="container-fluid">
					<div class="d-flex align-items-start">
						<div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
							@foreach (ItemSlot slot in Enum.GetValues(typeof(ItemSlot)))
							{
								<button class="nav-link @(slot == ItemSlot.MainHand ? "active" : "")" id="v-pills-@(slot)-tab" data-bs-toggle="pill" data-bs-target="#v-pills-@slot" type="button" role="tab" aria-controls="v-pills-mainhand" aria-selected="true">@slot</button>
							}
						</div>
						<div class="tab-content" id="v-pills-tabContent">

							@foreach (ItemSlot slot in Enum.GetValues(typeof(ItemSlot)))
							{
								<div class="tab-pane fade show @(slot == ItemSlot.MainHand ? "active" : "")" id="v-pills-@slot" role="tabpanel" aria-labelledby="v-pills-@(slot)-tab">

									<h2>@slot</h2>

									@if (slot != ItemSlot.Neck && slot != ItemSlot.Trinket1 && slot != ItemSlot.Trinket2 && slot != ItemSlot.Ranged)
									{
										<a href="#" rel="spell=@simulation.settings.enchantSettings.enchants[slot].id" class="select-link"><div class="input-group mb-3">
										<span class="input-group-text" id="basic-addon1">Enchant</span>
										<select class="enchants"  @onchange="(e)=>EnchantSelected(e.Value, slot)">
										@foreach(Enchant enchant in Databases.EnchantDatabase.enchants)
										{
											if (slot == enchant.slot || enchant.id == 0 || (slot == ItemSlot.Ring2 && enchant.slot == ItemSlot.Ring1) || (slot == ItemSlot.OffHand && enchant.slot == ItemSlot.MainHand) ) {
													<option value="@enchant.id" selected="@(simulation.settings.enchantSettings.enchants[slot].id == enchant.id)">@enchant.name</option>
											}
										}
										</select>
										</div></a>
									}
									<br /><br />	
									
									Gems


  
<div class="select-box">
  <div class="select-box__current" tabindex="1">
    <div class="select-box__value">
      <input class="select-box__input" type="radio" id="0" value="1" name="Ben" checked="checked"/>
      <p class="select-box__input-text">Cream</p>
    </div>
    <div class="select-box__value">
      <input class="select-box__input" type="radio" id="1" value="2" name="Ben"/>
      <p class="select-box__input-text">Cheese</p>
    </div>
    <div class="select-box__value">
      <input class="select-box__input" type="radio" id="2" value="3" name="Ben"/>
      <p class="select-box__input-text">Milk</p>
    </div>
    <div class="select-box__value">
      <input class="select-box__input" type="radio" id="3" value="4" name="Ben"/>
      <p class="select-box__input-text">Honey</p>
    </div>
    <div class="select-box__value">
      <input class="select-box__input" type="radio" id="4" value="5" name="Ben"/>
      <p class="select-box__input-text">Toast</p>
    </div><img class="select-box__icon" src="http://cdn.onlinewebfonts.com/svg/img_295694.svg" alt="Arrow Icon" aria-hidden="true"/>
  </div>
  <ul class="select-box__list">
    <li>
      <label class="select-box__option" for="0">Cream</label>
    </li>
    <li>
      <label class="select-box__option" for="1" aria-hidden="aria-hidden">Cheese</label>
    </li>
    <li>
      <label class="select-box__option" for="2" aria-hidden="aria-hidden">Milk</label>
    </li>
    <li>
      <label class="select-box__option" for="3" aria-hidden="aria-hidden">Honey</label>
    </li>
    <li>
      <label class="select-box__option" for="4" aria-hidden="aria-hidden">Toast</label>
    </li>
  </ul>
</div>
  

									<table>
										<thead>
											<tr>
												<td>Name</td>
												<td>Strength</td>
												<td>Agility</td>
												<td>Stamina</td>
												<td>Attack Power</td>
											</tr>
										</thead>
										@foreach (Item item in ItemDatabase.items)
										{
											if (item.itemSlot == slot ||
											(item.itemSlot == ItemSlot.MainHand && slot == ItemSlot.OffHand) ||
											(item.itemSlot == ItemSlot.Ring1 && slot == ItemSlot.Ring2) ||
											(item.itemSlot == ItemSlot.Trinket1 && slot == ItemSlot.Trinket2))
											{
												<tr class="@(item.id == simulation.settings.equipmentSettings.GetSlotId(slot) ? "equipped" : "")" @onclick="() => RowClicked(item.id, slot)">
													<td><a href="#" rel="item=@item.id" class="rowlink">@item.name</a></td>
													<td>@item.strength</td>
													<td>@item.agility</td>
													<td>@item.stamina</td>
													<td>@item.attackPower</td>
												</tr>
											}
										}
									</table>
								</div>
							}
						</div>
					</div>
				</div>
			</div>
		</div>




	</section>
</EditForm>

@code {
	public EditContext editContext;
	public ItemSlot currentTab { get; set; } = ItemSlot.MainHand;
	protected override void OnInitialized()
	{
		var storedSettings = localStorage.GetItem<Warrior.Settings.Settings>("Settings");
		if (storedSettings != null)
		{
			simulation.settings = storedSettings;
		}
		editContext = new EditContext(simulation);
		editContext.OnFieldChanged += (sender, eventArgs) =>
		{
			Console.WriteLine("OnFieldChanged for FieldName = " + eventArgs.FieldIdentifier.FieldName + " " + sender.ToString());
			localStorage.SetItem("Settings", simulation.settings);
		};
		base.OnInitialized();
	}

	private Item[]? items;

	public void RowClicked(int id, ItemSlot slot)
	{
		simulation.settings.equipmentSettings.EquipItem(slot, id);
		localStorage.SetItem("Settings", simulation.settings);
	}

	public void EnchantSelected(object value, ItemSlot slot)
	{
		Console.WriteLine("Called enchantSelected: " + slot.ToString() + ":" + Int32.Parse(value.ToString()));
		simulation.settings.enchantSettings.SetEnchant(slot, Int32.Parse(value.ToString()));
		localStorage.SetItem("Settings", simulation.settings);
	}

	protected override async Task OnInitializedAsync()
	{
		//simulation = localStorage.GetItem<Simulation>("Simulation");
	}
}






